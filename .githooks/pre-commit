#!/bin/bash

# Hook Git pre-commit pour Flumen MMORPG
# Lance automatiquement les tests avant chaque commit

echo "ğŸ® Flumen MMORPG - Pre-commit Hook"
echo "=================================="

# VÃ©rifier si on est sur Windows (PowerShell disponible)
if command -v pwsh &> /dev/null; then
    echo "ğŸ” Lancement des tests avec PowerShell..."
    pwsh -ExecutionPolicy Bypass -File "./scripts/run_tests.ps1" -ExitOnFail
    exit_code=$?
elif command -v powershell &> /dev/null; then
    echo "ğŸ” Lancement des tests avec PowerShell (legacy)..."
    powershell -ExecutionPolicy Bypass -File "./scripts/run_tests.ps1" -ExitOnFail
    exit_code=$?
else
    echo "âŒ PowerShell non trouvÃ©. Impossible de lancer les tests."
    echo "ğŸ’¡ Installez PowerShell ou lancez manuellement: ./scripts/run_tests.ps1"
    exit 1
fi

# VÃ©rifier le rÃ©sultat des tests
if [ $exit_code -eq 0 ]; then
    echo "âœ… Tous les tests ont rÃ©ussi. Commit autorisÃ©."
    exit 0
else
    echo "âŒ Des tests ont Ã©chouÃ©. Commit annulÃ©."
    echo "ğŸ’¡ Corrigez les erreurs et recommitez."
    exit 1
fi
